<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />

        <title>Looper</title>

        <script type="text/javascript" src="cordova.js"></script>

        <style type="text/css">
            html, body { width:100%; height:100%; margin:0; padding:0; overflow:hidden; background-color:white; }
            div#fullpage { width:100%; height:100%; margin:0; padding:0; border:0px solid red; text-align:center; vertical-align:middle; }
            button { font-size: 18px; }
        </style>
    </head>

    <body onload="onLoad()">
    <script>
    var httpd = null;
    function onLoad() {
    	document.addEventListener ("deviceready", onDeviceReady, false);
    }

    function onDeviceReady () {
        httpd = ( cordova && cordova.plugins && cordova.plugins.CorHttpd ) ? cordova.plugins.CorHttpd : null;

        startServer("htdocs");
    }

    function updateStatus () {
    	document.getElementById('location').innerHTML = "document.location.href: " + document.location.href;
    	if (httpd) {
    		httpd.getURL (function (url) {
    			if(url.length > 0) {
    				document.getElementById('url').innerHTML = "server is up: <a href='" + url + "' target='_blank'>" + url + "</a>";
    			} else {
    				document.getElementById('url').innerHTML = "server is down.";
    			}

                document.getElementById('looper').innerHTML = "<a href='" + url + "/looper.html' target='_blank'>Looper</a>";
    		});
    		httpd.getLocalPath (function (path){
    			document.getElementById ('localpath').innerHTML = "<br/>localPath: " + path;
        	});
    	} else {
    		alert ('CorHttpd plugin not available/ready.');
    	}
    }

    function startServer (wwwroot) {
    	if (httpd) {
    	    httpd.getURL (function (url) {
                // alert ('url = ' + url);
    	    	if (url.length > 0) {
    	    		document.getElementById('url').innerHTML = "server is up: <a href='" + url + "' target='_blank'>" + url + "</a>";

	    	    } else {
    	    	    httpd.startServer ({
    	    	    	'www_root' : wwwroot,
    	    	    	'port' : 8080
    	    	    }, function (url) {
        	    		//document.getElementById('url').innerHTML = "server is started: <a href='" + url + "' target='_blank'>" + url + "</a>";
                        updateStatus();
                        alert(url);
    	    	    }, function (error) {
    	    	    	document.getElementById('url').innerHTML = 'failed to start server: ' + error;
    	    	    });
    	    	}
    	    	
    	    },function(){});
    	} else {
    		alert('CorHttpd plugin not available/ready.');
    	}
    }

    function stopServer () {
    	if (httpd) {
    	    httpd.stopServer(function(){
    	    	//document.getElementById ('url').innerHTML = 'server is stopped.';
                updateStatus();
    	    }, function (error){
    	    	document.getElementById ('url').innerHTML = 'failed to stop server' + error;
    	    });
    	} else {
    		alert ('CorHttpd plugin not available/ready.');
    	}
    }

    function getRequest () {
        if (httpd) {
            httpd.getRequest (function (url) {
                if(url.length > 0) {
                    document.getElementById('url').innerHTML = "server is UP!: <a href='" + url + "' target='_blank'>" + url + "</a>";
                } else {
                    document.getElementById('url').innerHTML = "server is DOWN!";
                }

                document.getElementById('looper').innerHTML = "<a href='" + url + "/looper.html' target='_blank'>Looper</a>";
            });
        } else {
            alert ('CorHttpd plugin not available/ready.');
        }


        // if (httpd) {
        //     httpd.getRequest(function(){
        //         //document.getElementById ('url').innerHTML = 'server is stopped.';
        //         // updateStatus();
        //         alert ('getRequest Success');
        //     }, function (error){
        //         alert (error);
        //         // document.getElementById ('url').innerHTML = 'failed to stop server' + error;
        //     });
        // } else {
        //     alert ('CorHttpd plugin not available/ready.');
        // }
    }

    function udpBroadcast () {

        // Start UDP transmitter
        // Simple usage, initialize once, setting the IP address and port of the intended receiver
        // udptransmit.initialize("192.168.1.133", 4445);
        udptransmit.initialize("192.168.1.255", 4445);

        // Then send messages over and over
        udptransmit.sendMessage("PIXEL UDP");
        udptransmit.sendMessage("PIXEL UDP");
        udptransmit.sendMessage("PIXEL UDP");
        udptransmit.sendMessage("PIXEL UDP");
        udptransmit.sendMessage("PIXEL UDP");

    }

    // Documentation: http://plugins.cordova.io/#/package/org.apache.cordova.device-motion
    function getAccelerometerData () {
        function onSuccess(acceleration) {
            document.getElementById('acceleration').innerHTML = 
                  'Acceleration X: ' + acceleration.x + '<br />' +
                  'Acceleration Y: ' + acceleration.y + '<br />' +
                  'Acceleration Z: ' + acceleration.z + '<br />' +
                  'Timestamp: '      + acceleration.timestamp;
        };

        function onError() {
            alert('onError!');
        };

        navigator.accelerometer.getCurrentAcceleration(onSuccess, onError);
    }

    </script>

    <div id="fullpage">
        <h2>HTTP Server</h2>

        <p><button onclick="startServer('htdocs');">Start Httpd at www/htdocs</button></p>
        <p><button onclick="startServer('/');">Start Httpd at /</button></p>
        <p><button onclick="stopServer();">Stop Httpd</button></p>
        <p><button onclick="updateStatus();">Check Status</button></p>
        <p><button onclick="getRequest();">Get Request</button></p>

        <div id='location'></div>
        <div id='url'></div>
        <div id='localpath'></div>

        <h2><div id="looper">Looper</div></h2>

        <p><button onclick="udpBroadcast();">UDP Broadcast</button></p>

        <!-- <h2>Accelerometer</h2> -->

        <p><button onclick="getAccelerometerData();">Accelerometer</button></p>

        <p>Accelerometer:</p>
        <div id="acceleration"></div>
    </div>
    
    </body>
</html>
